@using Microsoft.AspNetCore.Mvc.TagHelpers
@model List<SMS.DtoLayer.Student.StudentListDto>?

@{
  ViewBag.Title = "Students";
  Layout = "_Layout";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="~/css/modal.css"/>

<div class="container mt-4">
  @if (TempData["Success"] != null)
  {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      @TempData["Success"]
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  }

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Students</h4>
    <button type="button" class="btn btn-primary add-new-button" onclick="openModal()">
      Add New Record
    </button>
  </div>

  <table class="table">
    <thead>
    <tr>
      <th>Name</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var student in Model)
    {
      <tr>
        <td>@student.Name</td>
        <td>@student.Status</td>
        <td>
          <button class="btn btn-warning" onclick="openEditModal('@student.Id')">Edit</button>
        <td>
          <button class="btn btn-warning"  href="/Students/Edit/@student.Id">Edit</button>
        </td>
      </tr>
    }
    </tbody>
  </table>

  <div class="modal right" id="add-new-modal" tabindex="-1" role="dialog" aria-labelledby="addNewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addNewModalLabel">Add New Student</h5>
          <button type="button" class="btn-close" onclick="closeModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="add-student-form" asp-action="Create" asp-controller="Students" method="post">
            <div class="form-group">
              <label>Name:</label>
              <input type="text" class="form-control" name="Name" required>
            </div>
            <div class="form-group">
              <label>Date of Birth:</label>
              <input type="date" class="form-control" name="DateOfBirth" required>
            </div>
            <div class="form-group">
              <label>Image URL:</label>
              <input type="text" class="form-control" name="ImageUrl">
            </div>
            <div class="form-group">
              <label>Status:</label>
              <select class="form-control" name="Status">
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
          <button type="submit" form="add-student-form" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>
  

</div>

<script>
  // Add Student Modal (özel animasyonlu modal)
  function openModal() {
    const modal = document.getElementById('add-new-modal');
    modal.style.display = 'block';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    document.body.classList.add('modal-open');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    const modal = document.getElementById('add-new-modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display = 'none';
    }, 300);
    document.body.classList.remove('modal-open');
    document.body.style.overflow = 'auto';
  }

  // ESC ile kapatma
  document.addEventListener('keydown', function (event) {
    if (event.key === 'Escape') {
      closeModal();
    }
  });

  // Modal dışına tıklanınca kapatma
  document.getElementById('add-new-modal')?.addEventListener('click', function (event) {
    if (event.target === this) {
      closeModal();
    }
  });
  
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>